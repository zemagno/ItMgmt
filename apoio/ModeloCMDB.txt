<td><a href="/cis/<%= valor %>"/a><%= valor %></a></td>
select cis.chave,tipocis.tipo,cis.descricao,sites.nome, atributos.valor from cis, atributos,sites,tipocis where (atributos.dicdado_id = 6 or atributos.dicdado_id=10) and atributos.ci_id = cis.id and cis.site_id = sites.id and cis.tipoci_id = tipocis.id order by atributos.valor;



Chaves:
Atributos --> ci_id
dicdados --> tipoci_id
ci --> chave
contrato --> codcontrato



==============
CI (tipoci) - belong to tipoci, has many atributos
Tipoci (descricao) - has many dicdados (ainda tem a descricao dos 4 campos )
Dicdado (tipoci,nome,url:pattern) - belong to tipoci 
Atributo (ci,dicdado) - belong to tipoci, dicdado

select chave 
  from cis,tipocis 
  where 
        cis.tipoci_id = tipocis.id and 
        tipocis.tipo ="link" and 
        cis.id not in 
                  (select ci_id from atributos,dicdados where);

?:cis t:link -d:contrato 
t:server -d:IP

select tipocis.id from tipocis where tipo = 'link';
select dicdados.id from dicdados where nome = "contratos" and tipoci_id = :tipociid 
select ci_id from atributos where dicdado_id = :dicdadoid

select dicdados.id from dicdados,tipocis 
   where
      tipocis.tipo = 'link'and 
      nome = 'contrato' and 
      tipocis.id = dicdados.tipoci_id ;


select dicdados.id from dicdados,tipocis where tipocis.tipo = 'link' and nome = 'contrato' and tipocis.id = dicdados.tipoci_id ;

select chave 
  from cis,tipocis 
  where 
        cis.tipoci_id = tipocis.id and 
        tipocis.tipo ="link" and 
        cis.id not in  
               (select ci_id from atributos where dicdado_id = :dicdadoid)

select chave from cis,tipocis where cis.tipoci_id = tipocis.id and tipocis.tipo ="link" and cis.id not in select dicdados.id from dicdados,tipocis where tipocis.tipo = 'link' and nome = 'contrato' and tipocis.id = dicdados.tipoci_id

=ATENCAO===================================
ci.atributos (o que existe) esta contido em ci.tipoci.dicdados ( o que pode existir)
====================================
=todos os atributos de um ci====
ci.atributo[0].dicdado.nome
ci.atributo[0].valor
====================================
=todos os atributos possiveis de um ci==
ci.tipoci.dicdados
====================================

Tipoci.create(tipo: "Servico")
Tipoci.create(tipo: "Link")
Tipoci.create(tipo: "Servidor")
Tipoci.create(tipo: "Ambiente")

ci = Ci.create(chave: "rjsrvdb252", descricao: "Servidor SQL Server de producao", site: site, tipoci: tipoci)

truncate tasklist_development.tipocis;
insert into tasklist_development.tipocis (tipo) select distinct tipo from tabci;

truncate tasklist_development.sites;
insert into tasklist_development.sites(nome) select distinct localidade from tabci;
select * from tasklist_development.sites;

truncate tasklist_development.cis;
insert into tasklist_development.cis(chave,descricao, tipoci_id, site_id) select chave, elemento, tasklist_development.tipocis.id, tasklist_development.sites.id from tabci, tasklist_development.tipocis, tasklist_development.sites where tabci.tipo = tasklist_development.tipocis.tipo and tabci.localidade = tasklist_development.sites.nome;


truncate tasklist_development.relacionamentos;
insert into tasklist_development.relacionamentos (impactado_id, dependente_id) select a.id, b.id from relacionamentos, tasklist_development.cis a, tasklist_development.cis b 
where relacionamentos.item1 = a.chave and  relacionamentos.item2 = b.chave ;

truncate tasklist_development.fornecedores;
insert into tasklist_development.fornecedores (nome) select distinct fornecedor from tabcontratos;

truncate tasklist_development.tipocontratos;
insert into tasklist_development.tipocontratos (descricao) select distinct tipo from tabcontratos;

truncate tasklist_development.indicadores_financeiros;
insert into tasklist_development.indicadores_financeiros (nome) select distinct indice_reajuste from tabcontratos;

truncate tasklist_development.contratos ;

insert into tasklist_development.contratos (
codcontrato,
descricao,
tipocontrato_id,
valormensal,
datainicio,
datafim,
datarenovacao,
fornecedor_id,
projetoCCTI,
indicador_financeiro_id,
classificacao,
projetoCCArea)


select 
tabcontratos.Cod_Contrato,
tabcontratos.Descricao,
tasklist_development.tipocontratos.id,
tabcontratos.Valor,
tabcontratos.Data_Inicio,
tabcontratos.Data_Contrato,
tabcontratos.Prox_Data_Renovacao,
tasklist_development.Fornecedores.id,
tabcontratos.CD_Projeto,
tabcontratos.Indice_Reajuste,
tabcontratos.Classificacao,
tabcontratos.CD_Projeto_Cobranca
from tabcontratos, tasklist_development.tipocontratos, tasklist_development.fornecedores
where
  tabcontratos.tipo=tasklist_development.tipocontratos.descricao and
  fornecedor=tasklist_development.fornecedores.nome ;


bundle exec rake ts:reindexx


t.string :codcontrato
t.string :descricao
t.references :tipocontrato
t.date :datainicio
t.date :datafim

rails g scaffold fornecedor nome:string nomecompleto:string cnpj:string endereco:string contatos:string 
rails g scaffold indicador_financeiro nome:string
rails g scaffold contrato codcontrato:string descricao:string valormensal:decimal tipocontrato:references fornecedor:references datainicio:date datafim:date datarenovacao:date indicador_financeiro:references projetoCCTI:string projetoCCArea:string

rails generate scaffold dicdado nome:string tipoci:references
rails generate migration AddOrdemToDicdados ordem:integer

rails g model Atributos ci:references dicdado:reference valor:string 

id_ci, id_campo, valor

